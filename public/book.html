<!DOCTYPE html>
<html>
<head>
  <title>Book Appointment</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ede9fe, #f5f3ff);
      min-height: 100vh;
    }

    nav {
      background: #7c3aed;
      padding: 15px 30px;
    }

    nav a {
      color: white;
      margin-right: 20px;
      text-decoration: none;
      font-weight: bold;
    }

    .card {
      max-width: 480px;
      margin: 60px auto;
      background: white;
      padding: 40px;
      border-radius: 18px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
      text-align: center;
    }

    h2 {
      color: #5b21b6;
      margin-bottom: 25px;
    }

    input, select {
      width: 100%;
      padding: 14px;
      margin: 12px 0;
      border-radius: 10px;
      border: 1px solid #c4b5fd;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      background: #7c3aed;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #5b21b6;
    }
  </style>
</head>
<body>

<nav>
  <a href="/home.html">Home</a>
  <a href="/book.html">Book</a>
  <a href="/booked.html">My Bookings</a>
  <a href="#" onclick="logout()">Logout</a>
</nav>

<div class="card">
  <h2>Book Appointment</h2>

  <!-- DATE PICKER -->
  <input type="date" id="date">

  <!-- SLOT DROPDOWN -->
  <select id="slots"></select>

  <button onclick="book()">Confirm Booking</button>
</div>

<script>
/* ðŸ”’ AUTH */
if (localStorage.getItem("role") !== "user") {
  localStorage.clear();
  location.href = "/user-login.html";
}

function logout() {
  localStorage.clear();
  location.href = "/role.html";
}

/* ðŸš« DISABLE PAST DATES */
const dateInput = document.getElementById("date");
const today = new Date().toISOString().split("T")[0];
dateInput.min = today;
dateInput.value = today;

dateInput.addEventListener("change", loadSlots);

/* LOAD SLOTS */
function loadSlots() {
  fetch(`https://smart-booking-backend.vercel.app/api/slots?date=${date}`)
    .then(res => res.json())
    .then(data => {
      const slots = document.getElementById("slots");
      slots.innerHTML = "";

      if (data.length === 0) {
        const opt = document.createElement("option");
        opt.text = "No slots available";
        slots.appendChild(opt);
        return;
      }

      data.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.text = s.time;
        slots.appendChild(opt);
      });
    });
}

loadSlots();

/* BOOK */
function book() {
  const slotId = document.getElementById("slots").value;

  if (!slotId || slotId === "No slots available") {
    alert("Please select a valid slot");
    return;
  }

  fetch("https://smart-booking-backend.vercel.app/api/book", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      slot_id: slotId,
      username: localStorage.getItem("username")
    })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    loadSlots();
  });
}
</script>

</body>
</html>
