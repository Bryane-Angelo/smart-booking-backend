<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="container" id="loginBox">
  <h2 id="title"></h2>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button id="loginBtn">Login</button>

  <!-- USER ONLY -->
  <p id="signupLink" style="display:none; margin-top:10px;">
    New user? <a href="/signup.html">Create account</a>
  </p>

  <button
    onclick="location.href='/role.html'"
    style="background:#64748b;margin-top:10px">
    Back
  </button>

  <p id="error" style="color:red;"></p>
</div>

<script>
/* ðŸ”’ READ ROLE ONCE */
const role = localStorage.getItem("loginRole");

/* ðŸš« NO ROLE â†’ GO BACK */
if (!role) {
  window.location.href = "/role.html";
}

/* ðŸŽ¨ FORCE VISUAL DIFFERENCE */
const title = document.getElementById("title");
const box = document.getElementById("loginBox");

if (role === "admin") {
  title.innerText = "ADMIN LOGIN";
  box.style.border = "3px solid #dc2626";
  box.style.background = "#fff5f5";
} else {
  title.innerText = "USER LOGIN";
  document.getElementById("signupLink").style.display = "block";
}

/* ðŸ” LOGIN */
document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!username || !password) {
    document.getElementById("error").innerText = "Enter credentials";
    return;
  }

  const res = await fetch("/api/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      username,
      password,
      role
    })
  });

  const data = await res.json();

  if (!data.success) {
    document.getElementById("error").innerText = "Invalid credentials";
    return;
  }

  localStorage.setItem("username", data.username);
  localStorage.setItem("role", role);

  if (role === "admin") {
    window.location.href = "/admin.html";
  } else {
    window.location.href = "/home.html";
  }
});
</script>

</body>
</html>
